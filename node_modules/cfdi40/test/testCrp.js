const fs = require('fs');
const CFDI = require('../src/CFDI');

const key = './LAN7008173R5.key';
const cer = './LAN7008173R5.cer';

const cfdi = new CFDI({
    Version: '3.3',
    Serie: 'A',
    Folio: '167ABC',
    Fecha: '2018-01-16T09:33:43',
    SubTotal: '0',
    Total: '0',
    Moneda: 'XXX',
    TipoDeComprobante: 'P',
    Exportacion: '01',
    LugarExpedicion: '45079'
}).emisor({
    Rfc: 'SAT',
    Nombre: 'SAT SA DE CV',
    RegimenFiscal: '601'
}).receptor({
    Rfc: 'MALD930428US2',
    Nombre: 'DAVID ISAAC MARTINEZ LOPEZ',
    UsoCFDI: 'G01'
})

cfdi.concepto({
    ClaveProdServ: '84111506',
    Cantidad: 1,
    ClaveUnidad: 'ACT',
    Descripcion: 'Pago',
    ValorUnitario: 0,
    Importe: 0,
}).agregar(cfdi);

cfdi.Pago({
  FechaPago: '2018-01-16T09:33:43',
  FormaDePagoP: '03',
  MonedaP: 'MXN',
  Monto: '429.00'
}).DoctoRelacionado({
  IdDocumento: '83805D05-4538-5C99-BC5C-5C73AEB7D0EB',
  MonedaDR: 'MXN',
  NumParcialidad: '1',
  Serie: 'A',
  Folio: '167ABC',
  ImpSaldoAnt: '429.00',
  ImpSaldoInsoluto: '0.00',
  MetodoDePagoDR: 'PPD',
  impPagado: '429.00',
}).agregar(cfdi);


cfdi.impuestosP({
    TrasladoP: [
        {
            BaseP:"100.00",
            ImporteP:"16.00",
            ImpuestoP:"002",
            TasaOCuotaP:"0.160000",
            TipoFactorP:"Tasa"
        }   
    ]
})

cfdi
.certificar(cer)
.xmlSellado(key, '12345678a')
.then(xml => fs.writeFileSync('./testCRP.xml', xml))
.catch(err => console.log(err));